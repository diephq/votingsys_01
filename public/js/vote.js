$(document).ready(function(){function e(){$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error")}function t(e){var e="<span class='glyphicon glyphicon-warning-sign'></span> "+e;$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(e),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error")}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".loader").hide(),$.extend({xResponse:function(e,i,a){var o=null;return $.ajax({url:e,type:"POST",data:i,dataType:"json",async:!1,beforeSend:function(){$(".loader").show()},success:function(e){o=e.status},complete:function(){$(".loader").hide()},error:function(){t(a),$(".loader").hide()}}),o}}),$(".btn-vote").prop("disabled",!0),$(".btn-vote").on("click",function(){var i=/^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i;divChangeAmount=$(this).parent();var a=(divChangeAmount.data("url"),divChangeAmount.data("idPoll")),o=divChangeAmount.data("urlCheckExistEmail"),s=divChangeAmount.data("isRequiredEmail"),n=divChangeAmount.data("isRequiredName"),r=divChangeAmount.data("isRequiredNameAndEmail"),l=divChangeAmount.data("isNotSameEmail"),d=$(".nameVote").val(),h=$(".emailVote").val(),p="",m=divChangeAmount.data();if(1==s)if(""!=h.trim())if(i.test(h))if(d.trim().length>=100)divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("voteLimitName"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error");else{if(l){var g=$.xResponse(o,{idPoll:a,emailVote:h});if(g)return void t(m.messageEmailExists,m.messageErrorOccurs)}this.disabled=!0,e(),$(".message-validation").removeClass("alert alert-warning alert-poll-set-ip").html(""),$("#form-vote").submit(),$(".loader").show()}else divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageValidateEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error");else divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageRequiredEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error");else if(1==n)""!=d.trim()?d.trim().length<100?""!=h.trim()?i.test(h)?(this.disabled=!0,e(),$(".message-validation").removeClass("alert alert-warning alert-poll-set-ip").html(""),$("#form-vote").submit(),$(".loader").show()):(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageValidateEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error")):(this.disabled=!0,e(),$(".message-validation").removeClass("alert alert-warning alert-poll-set-ip").html(""),$("#form-vote").submit(),$(".loader").show()):(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("voteLimitName"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error")):(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageRequiredName"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error"));else if(1==r)if(""!=d.trim()&&d.trim().length<100)if(""==h.trim())divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageRequiredEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error");else if(i.test(h)){if(l){var g=$.xResponse(o,{idPoll:a,emailVote:h});if(g)return void t(m.messageEmailExists,m.messageErrorOccurs)}this.disabled=!0,e(),$(".message-validation").removeClass("alert alert-warning alert-poll-set-ip").html(""),$("#form-vote").submit(),$(".loader").show()}else divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageValidateEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error");else""==d.trim()?""==h.trim()?(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageRequiredNameAndEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").addClass("error")):(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageRequiredName"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error")):d.trim().length>=100&&(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("voteLimitName"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error"));else{var c=!1;if(""!=h.trim()?i.test(h)?c=!0:(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("messageValidateEmail"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".emailVote").addClass("error"),$(".nameVote").hasClass("error")&&$(".nameVote").removeClass("error")):c=!0,d.trim().length>=100&&(divChangeAmount=$(this).parent(),p="<span class='glyphicon glyphicon-warning-sign'></span> "+divChangeAmount.data("voteLimitName"),$(".message-validation").addClass("alert alert-warning alert-poll-set-ip").html(p),$(".nameVote").addClass("error"),$(".emailVote").hasClass("error")&&$(".emailVote").removeClass("error"),c=!1),c){if(l){var g=$.xResponse(o,{idPoll:a,emailVote:h});if(g)return void t(m.messageEmailExists,m.messageErrorOccurs)}this.disabled=!0,e(),$(".message-validation").removeClass("alert alert-warning alert-poll-set-ip").html(""),$("#form-vote").submit(),$(".loader").show()}}}),$(".btn-edit-submit").on("click",function(){var e=!1;if($("input[id^=optionText]").each(function(){if(""==$(this).val())return e=!0}),e){var t=$(".vote-style").data("option").message.option_required;return $(".btn-edit-submit").prop("disabled",!0),void $(".error_option").addClass("has-error").html('<span id="title-error" class="help-block">'+t+"</span>")}$(".btn-edit-submit").prop("disabled",!1),$("#edit-voted-content").submit()}),$("#message-flash").fadeIn().delay(3e3).fadeOut(),$("#frame-upload-image-edit").on("hidden.bs.modal",function(){$("body").attr("class","modal-open")}),$(".edit-each-option").on("click",function(){var e=$(this).closest(".vote-style").data("option"),t=e.view.option,i={optionText:{}},a=$(".content-option-vote").length?$(".content-option-vote"):$(".content-option-not-image");a.each(function(e){var t=$('input[name="option[]"]').eq(e).val();i.optionText[t]=$(this).text()}),$(".poll-option").html(""),createOption(t,"",i);var o=["checkOptionSame('",e.message.option_duplicate,"')"].join("");$("#frame-edit-poll").find(".btn-remove-option").remove(),$("#frame-edit-poll").find("input[name^=optionText]").removeAttr("onfocus onclick").attr({onblur:o,onkeyup:o}),pickDateOption(),$(".li-parent-vote").find(".image-option-vote").each(function(e){var t=$(this).prop("src");t.indexOf("default-thumb.gif")==-1&&($("#frame-edit-poll").find(".render-img").eq(e).attr("src",t),$("#frame-edit-poll").find(".box-media-image").eq(e).css("display","inline-block"))}),$("#frame-edit-poll").modal("show")}),$(".horizontal-overflow").on("click",".hidden-counter",function(){var e=$(this).data("url-modal-voter");$.ajax({url:e,method:"GET",dataType:"json",success:function(e){e.status&&($("#result-voters").html(e.voters),$(".loader").hide())},beforeSend:function(){$(".loader").show()},complete:function(){$(".loader").hide(),$("#voters-modal").modal("show")}})})});var jqAddNewImageOption11=new jqAddImageOption({wrapperPoll:".poll-option",parentOption:".form-group",thumbImageOption:".render-img",btnChooseImage:".upload-photo",frImage:"#frame-upload-image-edit",frUploadFile:".photo-tb-upload-edit",frPreImage:".img-pre-option-edit",frAddImgLink:".add-image-by-link-edit",frInputText:".photo-tb-url-txt-edit",frDelPhoto:".photo-tb-del-edit",frConfirmYes:".btn-yes-edit",frInputFileTemp:".fileImgTempEdit",frContentError:".error-win-img-edit",messages:"div[data-option]"}),addNewOption=function(){this.init=function(){this.cacheDom(),this.bindEvent()},this.cacheDom=function(){this.$preview=$(".render-img"),this.$btnFileImg=$(".btn-file-img"),this.$deleteImg=$(".deleteImg"),this.$parentThumb=$(".box-media-image"),this.$newOption=$(".new-option"),this.$liParent=$(".parent-vote"),this.$inputTextOption=$(".text-new-option"),this.$allOption=$("input[id^=horizontal]"),this.$contentOption=$(".option-name").find("span"),this.$btnVote=$(".btn-vote"),this.$boxVote=$("#voting_wizard"),this.$voteImageWrapper=$(".vote-preview-wrapper"),this.$horizontalWrapper=$(".horizontal-overflow"),this.isRadio=this.$newOption.is(":radio"),this.$showError=$("#error_option"),this.messageValidate=this.$showError.data("message"),this.$datePicker=$(".date-time-picker"),this.$pickDate=$(".pick-date")},this.bindEvent=function(){this.$showError.hide(),this.$preview.on("load",this.loadPreImage.bind(this)),this.$inputTextOption.on("input",this.addText.bind(this)),this.$boxVote.on("click",".new-option",this.chooseOption.bind(this)),this.$boxVote.on("click",".parent-vote",this.chooseOptionWithLi.bind(this)),this.$pickDate.on("click",this.getTextDatePicker.bind(this)),this.$datePicker.on("dp.hide",this.addTextDate.bind(this))},this.loadPreImage=function(){this.$deleteImg.show(),this.$voteImageWrapper.css("border","1px solid #ccc"),this.$voteImageWrapper.css("border-top","none")},this.getTextDatePicker=function(){this.$pickDate.data("isHasDate",!0);var e="undefined"==typeof this.addText()?"":this.addText().trim();this._isValidDate(e)&&(e=""),this.$datePicker.data("preText",e),this.$datePicker.datetimepicker({showClose:!0,icons:{close:"glyphicon glyphicon-ok"}}).data("DateTimePicker").show()},this.addTextDate=function(e){var t=moment(e.date).format("MM/DD/YYYY h:mm A"),i=this.$datePicker.data("preText"),a=(i+" "+t).trim();this.$inputTextOption.val(a),this.$datePicker.data("DateTimePicker").hide().destroy(),this.$pickDate.data("isHasDate",!1)},this.readURL=function(){var e=this.$inputFileImg[0],t=this._checkExtensionImage(e),i=this.$inputTextOption.val();if(!this._validateDuplicate(i))if(t){if(this.$showError.hide(),e.files&&e.files[0]){var a=new FileReader;a.onload=this._renderImage.bind(this),a.readAsDataURL(e.files[0])}}else this.$inputFileImg.val(""),this._displayError(this.messageValidate.image)},this.deletePhoto=function(){this.$preview.attr("src","").hide(),this.$parentThumb.hide(),this.$deleteImg.hide(),this.$voteImageWrapper.css("border","none"),""==this.$inputTextOption.val()&&this._notViewSubmit()},this.addText=function(){var e=this.$inputTextOption.val().trim();return this._validateDuplicate(e)?(this._notViewSubmit(),void this._displayError(this.messageValidate.option_duplicate)):(this.$showError.hide(),this.isRadio&&$("input[id^=horizontal]").prop("checked",!1),""!=e||this.$pickDate.data("isHasDate")?(this._viewSubmit(),e):void this._notViewSubmit())},this.chooseOption=function(e){var t=this.$inputTextOption.val();if(""==t&&(this.isRadio&&(this.$btnVote.prop("disabled",!0),this.$newOption.prop("checked",!1)),this.deletePhoto()),this.isRadio)$("input[id^=horizontal]").prop("checked",!1);else{if(!this.$newOption.prop("checked")&&!$("input[id^=horizontal]").is(":checked"))return void this.$btnVote.prop("disabled",!0);this.$btnVote.prop("disabled",!1)}},this.chooseOptionWithLi=function(){this.isRadio&&(this.$newOption.prop("checked",!1),this.$inputTextOption.val(""),this.deletePhoto()),this.$btnVote.prop("disabled",!$("input[id^=horizontal]").is(":checked")),this.$newOption.is(":checked")&&this.$btnVote.prop("disabled",!1)},this._viewSubmit=function(){this.$newOption.prop("checked",!0),this.$btnVote.prop("disabled",!1)},this._notViewSubmit=function(){$("input[id^=horizontal]").is(":checked")||this.$btnVote.prop("disabled",!0),this.$newOption.prop("checked",!1)},this._renderImage=function(e){this.isRadio&&$("input[id^=horizontal]").prop("checked",!1),this.$preview.attr("src",e.target.result).show(),this.$deleteImg.show(),this.$voteImageWrapper.css("border","1px solid #ccc"),this.$voteImageWrapper.css("border-top","none"),this._viewSubmit(),this._toScrollLast()},this._checkExtensionImage=function(e){var t=e.value,i=t.substring(t.lastIndexOf(".")+1).toLowerCase(),a=["gif","png","bmp","jpeg","jpg"];return a.indexOf(i)>-1},this._validateDuplicate=function(e){var t=!1;return this.$contentOption.each(function(){if(e==$(this).text())return t=!0}),t},this._toScrollLast=function(){var e=$(".horizontal-overflow").prop("scrollHeight");e>400&&this.$horizontalWrapper.animate({scrollTop:e},1e3)},this._displayError=function(e){this.$showError.find(".help-block").text(e),this.$showError.show(),this._toScrollLast()},this._isValidDate=function(e){var t=/^\d{2}\/\d{2}\/\d{4}\s+[\d]+:\d{2}\s+(AM|PM)$/;return null!=e.match(t)}},jqAddNewImageOption=new jqAddImageOption({wrapperPoll:".horizontal-overflow",btnChooseImage:".upload-photo",parentOption:".parent-vote-new-option",messages:"div[data-message]",frImage:"#frame-upload-image",frUploadFile:".photo-tb-upload",frPreImage:".img-pre-option",frAddImgLink:".add-image-by-link",frInputText:".photo-tb-url-txt",frDelPhoto:".photo-tb-del",frConfirmYes:".btn-yes",frInputFileTemp:".fileImgTemp",frContentError:".error-win-img",messages:"div[data-option]",horizontalWrapper:".horizontal-overflow"}),addOption=new addNewOption;addOption.init();